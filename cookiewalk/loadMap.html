<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì €ì¥ëœ ê·¸ë¦¼ ë¶ˆëŸ¬ì˜¤ê¸°</title>
  <script src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=t0xghbfgfz"></script>
  <style>
body { margin-top: 30px; }
    .map-container { margin-bottom: 40px; position: relative; }
    .map { height: 400px; }
    .controls { text-align: center; margin-top: 8px; }
    button { margin-right: 10px; }
    .legend {
      display: flex;
      position: fixed;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      background-color: rgba(255, 255, 255, 0.9);
      padding: 5px 10px;
      font-size: 12px;
      border-radius: 5px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      z-index: 1000;
    }
    .legend-item { margin-right: 10px; align-items: center; display: flex; }
    .color-dot { height: 10px; width: 10px; border-radius: 50%; margin-right: 5px; }
    .red { background-color: #FF0000; }
    .green { background-color: #00FF00; }
    .blue { background-color: #0000FF; }
  </style>
</head>
<body>

  <div class="legend" id="legend">
    <div class="legend-item"><div class="color-dot red"></div>ì¶œë°œì§€</div>
    <div class="legend-item"><div class="color-dot green"></div>ë„ì°©ì§€</div>
    <div class="legend-item"><div class="color-dot blue"></div>ì¶œë°œì§€=ë„ì°©ì§€</div>
  </div>

  <script>
document.addEventListener("DOMContentLoaded", function() {
      var savedMaps = JSON.parse(localStorage.getItem('savedMaps')) || [];
      updateMapDisplay();

      function initializeMapContainer(mapData, index) {
        var containerId = 'map-container-' + index;
        var container = document.createElement('div');
        container.id = containerId;
        container.className = 'map-container';
        document.body.appendChild(container);


        var mapDiv = document.createElement('div');
        mapDiv.className = 'map';
        container.appendChild(mapDiv);

      var controlsDiv = document.createElement('div');
      controlsDiv.className = 'controls';
      container.appendChild(controlsDiv);

      var startWalkingBtn = document.createElement('button');
      startWalkingBtn.innerHTML = 'ğŸš¶â€â™‚ï¸ ê±·ê¸° ì‹œì‘'; // ì´ëª¨í‹°ì½˜ ì¶”ê°€
      controlsDiv.appendChild(startWalkingBtn);

      var toggleDrawingBtn = document.createElement('button');
      toggleDrawingBtn.innerHTML = 'ğŸ™ˆ ë„ë©´ ìˆ¨ê¹€'; // ì´ëª¨í‹°ì½˜ ì¶”ê°€
      controlsDiv.appendChild(toggleDrawingBtn);

      var deleteMapBtn = document.createElement('button');
      deleteMapBtn.innerHTML = 'ğŸ—‘ï¸ ì§€ë„ ì‚­ì œ'; // ì´ëª¨í‹°ì½˜ ì¶”ê°€
      // 'ì§€ë„ ì‚­ì œ' ë²„íŠ¼ì„ 'ë„ë©´ ìˆ¨ê¹€' ë²„íŠ¼ ë’¤ì— ì¶”ê°€í•©ë‹ˆë‹¤.
      controlsDiv.appendChild(deleteMapBtn);    


      var mapOptions = {
        center: new naver.maps.LatLng(37.3595704, 127.105399),
        zoom: 17
      };
      var map = new naver.maps.Map(mapDiv, mapOptions);

        // ì €ì¥ëœ ê²½ë¡œì—ì„œ ì¶œë°œì§€ì™€ ë„ì°©ì§€ ì¢Œí‘œë¥¼ ì¶”ì¶œ
    var savedPath = JSON.parse(mapData.path).map(function(p) { return new naver.maps.LatLng(p.lat, p.lng); });
    var startCoord = savedPath[0];
    var endCoord = savedPath[savedPath.length - 1];

    // ì¶œë°œì§€ì™€ ë„ì°©ì§€ì— ë§ˆì»¤ ìƒì„±
     
  console.log("Loaded start marker color: ", mapData.startMarkerColor);  // ì½˜ì†” ë¡œê·¸ ì¶”ê°€

   // ì¶œë°œì§€ ë§ˆì»¤ì— ì €ì¥ëœ ìƒ‰ìƒì„ ì ìš©í•©ë‹ˆë‹¤.
var startMarker = new naver.maps.Marker({
    position: startCoord,
    map: map,
    icon: {
        content: '<div style="width:14px; height:14px; background-color:' + mapData.startMarkerColor + '; border-radius:50%; border: 2px solid white;"></div>',
        anchor: new naver.maps.Point(7, 7)
    }
});

// ë„ì°©ì§€ ë§ˆì»¤ì—ë„ ì €ì¥ëœ ìƒ‰ìƒì„ ì ìš©í•©ë‹ˆë‹¤. (ì—¬ê¸°ì„œëŠ” 'endMarkerColor'ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ìˆ˜ì •í•´ì•¼ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.)
var endMarker = new naver.maps.Marker({
    position: endCoord,
    map: map,
    icon: {
      content: '<div style="width:14px; height:14px; background-color:' + mapData.endMarkerColor + '; border-radius:50%; border: 2px solid white;"></div>',
        anchor: new naver.maps.Point(7, 7)
    }
});


      var currentMarker = new naver.maps.Marker({
        position: mapOptions.center,
        map: map,
        icon: {
          content: '<div style="width:10px; height:10px; background-color:black; border-radius:50%;"></div>',
          anchor: new naver.maps.Point(5, 5)
        }
      });

      var polyline = new naver.maps.Polyline({
        map: map,
        path: JSON.parse(mapData.path).map(function(p) { return new naver.maps.LatLng(p.lat, p.lng); }),
        strokeColor: '#808080',
        strokeWeight: 3
      });

      var walking = false;
      var walkPath = [];
      var walkPolyline = new naver.maps.Polyline({
        map: null,
        strokeColor: mapData.color, // Use the saved color for new paths
        strokeWeight: 3
      });

      function handleWalking(position) {
        var currentLocation = new naver.maps.LatLng(position.coords.latitude, position.coords.longitude);
        map.setCenter(currentLocation);
        currentMarker.setPosition(currentLocation);
        if (walking) {
          walkPath.push(currentLocation);
          walkPolyline.setPath(walkPath);
        }
      }

      if (navigator.geolocation) {
        navigator.geolocation.watchPosition(handleWalking, function(error) {
          console.error('Geolocation error: ' + error.message);
        }, {
          maximumAge: 10000,
          timeout: 5000,
          enableHighAccuracy: true
        });
      } else {
        alert("ì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” Geolocationì´ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
      }

      startWalkingBtn.addEventListener('click', function() {
        walking = !walking;
        if (walking) {
          walkPolyline.setMap(map);
         startWalkingBtn.innerHTML = 'ğŸ›‘ ê±·ê¸° ì¤‘ì§€'; // ì´ëª¨í‹°ì½˜ ë° í…ìŠ¤íŠ¸ ë³€ê²½
        } else {
          startWalkingBtn.innerHTML = 'ğŸš¶â€â™‚ï¸ ê±·ê¸° ì‹œì‘'; // ì´ëª¨í‹°ì½˜ ë° í…ìŠ¤íŠ¸ ë³€ê²½
          map.setCursor('');
        }
      });

      toggleDrawingBtn.addEventListener('click', function() {
    if (polyline.getMap()) {
        polyline.setMap(null);
        startMarker.setMap(null);  // ì¶œë°œì§€ ë§ˆì»¤ ìˆ¨ê¹€
        endMarker.setMap(null);    // ë„ì°©ì§€ ë§ˆì»¤ ìˆ¨ê¹€
        toggleDrawingBtn.innerHTML = 'ğŸ‘€ ë„ë©´ ë³´ê¸°'; // ì´ëª¨í‹°ì½˜ ë° í…ìŠ¤íŠ¸ ë³€ê²½
    } else {
        polyline.setMap(map);
        startMarker.setMap(map);   // ì¶œë°œì§€ ë§ˆì»¤ ë³´ì„
        endMarker.setMap(map);     // ë„ì°©ì§€ ë§ˆì»¤ ë³´ì„
        toggleDrawingBtn.innerHTML = 'ğŸ™ˆ ë„ë©´ ìˆ¨ê¹€'; // ì´ëª¨í‹°ì½˜ ë° í…ìŠ¤íŠ¸ ë³€ê²½
          }
});

deleteMapBtn.addEventListener('click', function() {
          savedMaps.splice(index, 1);
          localStorage.setItem('savedMaps', JSON.stringify(savedMaps));
          document.getElementById(containerId).remove();
          updateMapDisplay();
        });
      }

      function displayNoMapsText() {
        var noMapsText = document.createElement('p');
        noMapsText.textContent = 'ì €ì¥ëœ ì§€ë„ê°€ ì—†ìŠµë‹ˆë‹¤.';
        document.body.appendChild(noMapsText);
      }

      function updateMapDisplay() {
        document.body.querySelectorAll('.map-container').forEach(el => el.remove());
        if (savedMaps.length === 0) {
          displayNoMapsText();
          document.getElementById('legend').style.display = 'none';
        } else {
          document.getElementById('legend').style.display = 'flex';
          savedMaps.forEach(initializeMapContainer);
        }
      }
    });

</script>
</body>
</html> 